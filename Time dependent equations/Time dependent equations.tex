\documentclass[../Main/main.tex]{subfiles}

\begin{document}
	\graphicspath{{../Time dependent equations/figs/}}
	\chapter{Time evolving equations}
	In this chapter we discuss numerical solving algorithms for parabolic equations with non-linearities, such as Richards' equation \eqref{eq:richards}. 
	\section*{Time discretization}
	We start by considering the most famous parabolic equation, namely the heat equation:
	
	\begin{equation}\label{eq:heat equation}
		\begin{aligned}[c]
			\partial_t u - \nabla \cdot \pmb{K} \nabla u &= F \\
			u &= 0 \\
			\pmb{K}\nabla u &= g_N\\
			u &= u_0
		\end{aligned}
		\ \ \
		\begin{aligned}[c]
			x &\in \Omega  \\
			x &\in \partial \Gamma_D \\
			x &\in \partial \Gamma_N \\
			x &\in \Omega  
		\end{aligned}
		\ \ \
		\begin{aligned}
			t&\in (0,T] \\
			t&\in (0,T] \\
			t&\in (0,T] \\
			t&=0
		\end{aligned}
	\end{equation}
	
	We expect low regularity in time, so there is not much gained by using a higher order discretization in time. The two choices we have left is the forward euler(explicit) and the backward euler(implicit). The obvious choice is backward euler, as it is stable for long timesteps. This can be understood intuitively by considering the parabolic nature of the equation, the signals spread trough the domain instantaneously. A careful analysis time discretization of parabolic equations is done in (\cite{Knabner}, chapter 7).  Here it is shown that explicit schemes only are stable for time-step proportional to the square of the space step, whereas fully implicit schemes are stable for all time-steps. \par  Let $\left \{ t_n \right \}_n$ be a sequence of $N+1$ evenly spaced numbers from $0$ to $T$ and let $\tau = \frac{T}{N}$ be the time-step. Then we state the semi-discrete version of \eqref{eq:heat equation} by exchanging the time derivative by a difference quotient $(\partial_t u)^n = \frac{u^n-u^{n-1}}{\tau}$. Note that this difference quotient is implicit because $u^n$ is not explicitly given by terms of the previous time-step
	\begin{equation}\label{eq:semidiscrete heat}
		\begin{aligned}[c]
			u^n - \tau \nabla \cdot \pmb{K} \nabla u^n &= \tau F^n+u^{n-1}\\
			u^n &= 0 \\
			\pmb{K}\nabla u &= g_N\\
			u^0 &= u_0
		\end{aligned}
		\ \ \
		\begin{aligned}[c]
			x &\in \Omega  \\
			x &\in \partial \Gamma_D \\
			x &\in \partial \Gamma_N \\
			x &\in \Omega  
		\end{aligned}
	\end{equation}
	Now we have an elliptic problem \eqref{eq:semidiscrete heat} for each time-step. This has almost the same structure as the elliptic model problem \eqref{eq:poisson} we solved in the previous chapters, the difference being that we have a $u^n$ term.
	\subsection*{Finite element approach}
	We are now ready to fit this problem into our finite element framework from chapter 2.
	The variational formulation of \eqref{eq:semidiscrete heat} is achieved as before by multiplying by test functions in $H^1_0(\Omega)$:
	\begin{equation}
		\begin{aligned}
			\text{find }u^n&\in V \text{ such that }\\
			\left \langle  u^n, v\right \rangle_0 + \tau \left \langle  \pmb{K} \nabla u^n, \nabla v \right \rangle_0 &=\tau \left \langle F^n,v\right \rangle_0 + \left \langle u^{n-1},v \right \rangle_0\\
			\text{for all }v&\in V
		\end{aligned}
	\end{equation}
	If we swap $V$ with  a finite dimensional subspace $V_h$, and write $u_h^n = \sum_{i = 1}^d (u_i^*)^n \phi_i $, as in the Galerkin FEM section, we end up with the system.
	\begin{equation}\label{eq:heat fem disc}
		\begin{aligned}
			\text{find }(\pmb{u}^*)^n&\in \mathbb{R}^d \text{ such that }\\
			\pmb{B}(\pmb{u}^*)^n+\tau\pmb{A}(\pmb{u}^*)^n &=\tau \pmb{F}^n +  \pmb{B}(\pmb{u}^*)^{n-1}
		\end{aligned}
	\end{equation}
	Where the \emph{stiffness matrix}, $\pmb{A}$, is as before. The matrix $\pmb{B}$ is often called the \emph{mass matrix} and is defined as $\pmb{B}_{i,j} = \int_{\Omega} \phi_i \phi_jdx$.
	\subsection*{Finite volume approach}
	As before we divide our domain $\Omega$ into control volumes $\left \{ \Omega_i \right \}_i$. One could write the heat equation\eqref{eq:heat equation} in conservation form on each control volume
	\begin{equation}
		\partial_t\int_{\Omega_i}u \ dx -\int_{\partial \Omega_i} \pmb{K}\nabla u \cdot \hat{\pmb{n}}\ dx = \int_{\Omega_i} F \ dx
	\end{equation}
	And discretize the first term with backward Euler. Or one could make sure the semi-discrete heat equation \eqref{eq:heat equation} holds for each control volume and use the divergence theorem. Both ways, we end up with
	\begin{equation}
		\int_{\Omega_i} u^n \ dx - \tau\int_{\partial \Omega_i} \pmb{K}\nabla u^n \cdot \hat{\pmb{n}}\ dx = \tau \int_{\Omega_i} F^n \ dx + \int_{\Omega_i} u^{n-1} \ dx
	\end{equation}
	As in chapter 3 we end up with a system of equations, where superscript $V$ is just to distinct between FVM and FEM.
	\begin{equation}\label{eq:heat fvm disc}
		(\pmb{B}^V + \tau \pmb{A}^V)\pmb{u}^n = \tau \pmb{F}^n + \pmb{B}^V\pmb{u}^{n-1}
	\end{equation}
	The matrix $\pmb{A}^V$ is as in chapter 3, with the fluxes trough the edges of cell $i$ described by the $j$th row of $\pmb{A}^V$. The matrix $\pmb{B}^V$ is diagonal with the entry $i$ being the volumes of the volume of cell $i$.

	If $\pmb{A}= \pmb{A}^V$, ie. that the discretization of the constitutive law is the same for both finite volume and finite element method. As we will see later, this is the challenging part.	
	
	\section*{Linearization}
	Now we have seen that the heat equation leads to a sequence of linear systems. In the same way, we expect that our non-linear Richards' equation \eqref{eq:richards} leads to a system of non-linear equations. We start by discussing this in a general setting
	\begin{equation}\label{eq:non-linear-problem}
		\text{find }x\in U \text{ such that }\pmb{f}(\pmb{x})=\pmb{0} \\ \text{ where } f:U\subset\mathbb{R}^n\rightarrow\mathbb{R}^n
	\end{equation}
	The solution in \eqref{eq:non-linear-problem} is called a \emph{root}, it is almost always found using an iterative method.\par 
	A common iterative scheme to solve \eqref{eq:non-linear-problem} is the \emph{Newton method}, let $D\pmb{f}(\pmb{x}_{j-1})^{-1}:\mathbb{R}^n\rightarrow\mathbb{R}^n$ be the Jacobian of $\pmb{f}(\pmb{x}_{j-1})$.
	\begin{equation}
		\pmb{x}_j = \pmb{x}_{j-1} -D\pmb{f}(\pmb{x}_{j-1})^{-1}\pmb{f}(\pmb{x}_{j-1})
	\end{equation}
	In one dimension a convergence proof i easily obtained by techniques from calculus, the following theorem is found in  slightly more detail in (Cheney\cite{Cheney}, chapter 3):
	\begin{theorem}
		Let $f''<2$ with $f(\overline{x})=0$ and $f'(x)> \delta \ \forall x \in B_{\epsilon}(\overline{x})$, then the Newton method is locally quadratic convergent:  For $x_0\in B_{\epsilon}(\overline{x})$ we have
		\begin{equation}
			| x_{j+1}-\overline{x}| \leq \frac{1}{\delta}|x_j - \overline{x}|^2< |x_j-\overline{x}|
		\end{equation}
	\end{theorem}
	\begin{proof}
		Define $e_n=x_n-\overline{x}$. Then we have by Taylor expansion
		\begin{equation}\label{eq:newton_taylor}
			0 = f(\overline{x})=f(x_j-e_j) = f(x_j)-f'(x_j)e_j + \frac{f''(\psi)e_j^2}{2}
		\end{equation}
		For some $\psi$ between $x_j$ and $\overline{x}$. Further we get by definition of the newton method
		\begin{equation}
			\begin{aligned}
				e_{j+1} = x_{j+1}-\overline{x} &= x_n-\frac{f(x_j)}{f'(x_j)}-\overline{x}\\
				&=e_j - \frac{f(x_j)}{f'(x_j)}\\ &= \frac{e_j f'(x_j)-f(x_j)}{f'(x_j)}
			\end{aligned}
		\end{equation}
		By the Taylor expansion around $x_j$, \eqref{eq:newton_taylor}, we get
		\begin{equation}
			e_{j+1} = \frac{e_j^2f''(\psi)}{2f'(x_j)}
		\end{equation}
	The assumptions on $f'$ and  $f''$ combined with $|e_0|<\delta$ give us the estimate
		\begin{equation}
			| e_{1} | \leq \frac{2}{2\delta}|e_0|^2<|e_0|
		\end{equation}
	By the same reasoning we get convergence
	\begin{equation}
		|e_{j+1}|<|e_j|
	\end{equation}
	And the quadratic convergence
	\begin{equation}
		| e_{j+1} | \leq \frac{1}{\delta}|e_j|^2
	\end{equation}
	\end{proof}
	For a similar result in more dimensions see (Knabner \cite{Knabner}, chapter 8). One apparent drawback of this method is that it's only locally convergent, ie. one needs to start the iteration in a neighbourhood of the root where the Jacobian is well defined. In practice one often solves the system
	\begin{equation}
		D\pmb{f}(\pmb{x}_{j-1})\pmb{\delta}_{j} = -\pmb{f}(\pmb{x}_{j-1})
	\end{equation}
	And then update the current iterate with $\pmb{x}_j = \pmb{x}_{j-1} + \pmb{\delta}_{j}$. One often end end up with a situation where the matrix $D\pmb{f}(\pmb{x}_{j-1})$ needs to be computed and assembled for every iteration. This may be computationally expensive. So Newtons method may be slow despite it's quadratic convergence, if it even converges.\par 
	A simpler approach is to swap the Jacobian with a diagonal matrix $L\pmb{I}$ such that 
	\begin{equation}
		L\pmb{\delta}_j = - \pmb{f}(\pmb{x}_{j-1})
	\end{equation}
	This is called the \emph{L-scheme}, and will be method we will use for linearization in this thesis. In one dimension it is easy to prove convergence:

	\begin{theorem}
		Let $f\in C(\mathbb{R})$ and $L>\sup_{x\in\mathbb{R}}f'(x)$, then the L-scheme converges linearly for all $x_0\in \mathbb{R}$.
	\end{theorem}
	\begin{proof}
		Define $e_j = e_j-\overline{x}$, then we get
		\begin{equation}
			e_{j+1} = x_j-\frac{f(x_j)}{L}-\overline{x}=e_j-\frac{f(x_j)}{L}
		\end{equation}
		We use the same trick as before with the Taylor expansion around the root.
		\begin{equation}
			0 = f(\overline{x}) = f(x_j-e_j) = f(e_j)-f'(\psi)e_j\Rightarrow e_j = \frac{f(x_j)}{f'(\psi)}
		\end{equation}
		Using this and the assumption on $L$ we get the estimate
		\begin{equation}
			|e_{j+1}|=|e_j(1-\frac{f'(\psi)f(x_j)}{f(x_j)L})|\leq|e_j||1-\frac{f'(\psi)}{L}|<|e_j|
		\end{equation}
	\end{proof}
	To see how this could be applied to parabolic PDE's we consider the equation:
	
	
	
	
	We will first consider the equation
	\begin{equation}\label{eq:richards simple}
		\begin{aligned}[c]
			\partial_t \theta(u) - \nabla \cdot \kappa \nabla u &= F \\
			u &= g \\
			u &= u_0
		\end{aligned}
		\ \ \
		\begin{aligned}[c]
			x &\in \Omega  \\
			x &\in \partial \Omega \\
			x &\in \Omega  
		\end{aligned}
		\ \ \
		\begin{aligned}
			t&\in (0,T] \\
			t&\in (0,T] \\
			t&=0
		\end{aligned}
	\end{equation}
	Which is similar to Richards' equation \eqref{eq:richards}, only without the gravity and non-linear permeability. We proceed as before by backward euler in time and we then discretize the elliptic PDE with a modified finite element method with mass lumping explained in the next chapter, see definition \ref{def:piecewise_interpolator}. The reasons for using modified FEM is that it's equivalent with the MPFA-L method. Anyway we get:
	\begin{equation}\label{eq:richards_timedisc}
		\begin{aligned}
			\text{find }u_h^n&\in V_h\\
			\left \langle \hat{I}_h \theta(u_h^n),\hat{I}_h v_h \right \rangle_0 +\tau \left \langle \kappa \nabla u^n_h, \nabla v_h \right \rangle_0 &= \tau \left \langle F^n,\hat{I}_h v_h \right \rangle_0 + \left \langle \hat{I}_h u_h^{n-1},\hat{I}_h v_h \right \rangle_0 \\
			\text{for all }v_h &\in V_h
		\end{aligned}
	\end{equation}
	We can then linearize $\theta(u^n_h)$ with the L-method, such that we en up with: Given $u^{n-1}_h$ and $u^{n,j-1}_h$ find $u^{n,j}_h$ such that:
	\begin{equation}\label{eq:L-scheme-FEM}
		\begin{aligned}
			\left \langle \hat{I}_h \theta(u^{n,j-1}_h),\hat{I}_h v_h \right \rangle_0 &+ L \left \langle \hat{I}_h u^{n,j}_h -  \hat{I}_h u^{n,j-1}_h,\hat{I}_h v_h \right \rangle_0 + \tau \left \langle \kappa \nabla u^{n,j}_h,\nabla v_h \right \rangle \\=\tau \left \langle F^n,\hat{I}_h v_h \right \rangle_0 &+ \left \langle \hat{I}_h u_h^{n-1},\hat{I}_h v_h \right \rangle_0 
		\end{aligned}
	\end{equation}
	We can now analyse the convergence behaviour of the L-method for Richards' with this discretization as in (List, Radu, 2016,\cite{list2016study}).
	First we need assumptions on the parametrizations $\kappa $ and $\theta$:
	\begin{itemize}
		\item[\textbf{A 1}] The water content parametrization $\theta(\cdot)$ is monotonically increasing with $sup|\theta'| = L_{\theta}$ and Lipschitz continuos.
		\item[\textbf{A 2}] The permeability $\kappa$ is positive. 
	\end{itemize}
	\begin{theorem}
		Assume \textbf{A 1} and \textbf{A 2} above and that the constant L is chosen such that $L \geq L_{\theta}$. Then the L-scheme \eqref{eq:L-scheme-FEM} converges linearly. 
	\end{theorem}
	\begin{proof}
		Let as before $e^{n,j} = u^{n,j}-u^n$ be the iteration error.
		We start by subtracting \eqref{eq:richards_timedisc} from \eqref{eq:L-scheme-FEM} and obtain:
			\begin{equation}
			\begin{aligned}
				\left \langle \hat{I}_h \theta(u^{n,j-1}_h) - \hat{I}_h \theta(u^{n}_h),\hat{I}_h v_h \right \rangle_0 &+ L \left \langle \hat{I}_h e^{n,j}_h -  \hat{I}_h e^{n,j-1}_h,\hat{I}_h v_h \right \rangle_0 \\+ \tau \left \langle \kappa (\nabla u^{n,j}_h-\nabla u^{n}_h),\nabla v_h \right \rangle_0 &=0 
			\end{aligned}
		\end{equation}
		Now we test with $v_h=e^{n,j}$:
		\begin{equation}
			\begin{aligned}
				\left \langle \hat{I}_h \theta(u^{n,j-1}_h) - \hat{I}_h \theta(u^{n}_h),\hat{I}_h e^{n,j} \right \rangle_0 &+ L \left \langle \hat{I}_h e^{n,j}_h -  \hat{I}_h e^{n,j-1}_h,\hat{I}_h e^{n,j} \right \rangle_0 \\+ \tau \left \langle \kappa\nabla e^{n,j},\nabla e^{n,j} \right \rangle_0 &=0 
			\end{aligned}
		\end{equation}
		We use the identity $\left \langle x-y,x\right \rangle = \frac{1}{2}\left \| x \right \|^2 + \frac{1}{2}\left \| x-y \right \|^2 - \frac{1}{2} \left \| y \right \|^2$ and some algebraic manipulation to obtain:
		\begin{equation}
			\begin{gathered}
					\left \langle \hat{I}_h \theta(u^{n,j-1}_h) - \hat{I}_h \theta(u^{n}_h),\hat{I}_h e^{n,j-1} \right \rangle + 	\left \langle \hat{I}_h \theta(u^{n,j-1}_h) - \hat{I}_h \theta(u^{n}_h),\hat{I}_h e^{n,j} - \hat{I}_h e^{n,j-1}\right \rangle \\
					+\frac{L}{2}\left \| \hat{I} e^{n,j}\right \|^2 + \frac{L}{2}\left \| \hat{I} e^{n,j}-\hat{I}e^{n,j-1} \right \|^2 -\frac{L}{2}\left \| \hat{I} e^{n,j-1}\right \|^2 \\
				+ \tau \left \langle \kappa \nabla e^{n,j},\nabla e^{n,j} \right \rangle_0 =0 
			\end{gathered}
		\end{equation}
		Then we put some terms on the right hand side:
		\begin{equation}
			\begin{gathered}
				\left \langle \hat{I}_h \theta(u^{n,j-1}_h) - \hat{I}_h \theta(u^{n}_h),\hat{I}_h e^{n,j-1} \right \rangle +\frac{L}{2}\left \| \hat{I} e^{n,j}\right \|^2 	 \\
				 + \frac{L}{2}\left \| \hat{I} e^{n,j}-\hat{I}e^{n,j-1} \right \|^2 + 
				\tau \left \langle \kappa\nabla e^{n,j},\nabla e^{n,j} \right \rangle_0  = \\ - \left \langle \hat{I}_h \theta(u^{n,j-1}_h) - \hat{I}_h \theta(u^{n}_h),\hat{I}_h e^{n,j} - \hat{I}_h e^{n,j-1}\right \rangle+\frac{L}{2}\left \| \hat{I} e^{n,j-1}\right \|^2
			\end{gathered}
		\end{equation}
		Now we use the Cauchy Swarchz inequality, and the monotonicity $\textbf{A 1}$ on the first term. Similarly we use Cauchy Swarchz and $\textbf{A 2}$ on the second term. Finally we use Young's inequality on the first term on the right hand side.
		\begin{equation}
			\begin{gathered}
				\frac{1}{L_{\theta}}\left \| \hat{I}_h (\theta(u^{n,j-1}-\theta(u^{n}))) \right \|^2 + \frac{L}{2}\left \| \hat{I} e^{n,j}\right \|^2 \\
				+ \frac{L}{2}\left \| \hat{I} e^{n,j}-\hat{I}e^{n,j-1} \right \|^2 + \tau \kappa_m \left \| \nabla e^{n,j} \right \|^2 \\
				\leq \frac{1}{2L} \left \| \hat{I}_h(\theta (u^{n,j-1})-\theta (u^n) ) \right \|^2  + \frac{L}{2} \left \|\hat{I}_h( e^{n,j} - e^{n,j-1}) \right \|^2+\frac{L}{2}\left \| \hat{I} e^{n,j-1}\right \|^2
			\end{gathered}
		\end{equation} 
		Next we can use Poincare inequality:
		\begin{equation}\label{eq:L-proof}
			\begin{gathered}
				\frac{L}{2}\left \| \hat{I}_h e^{n,j}\right\|^2 + \frac{\tau \kappa_m}{C_{\Omega}} \left \|e^{n,j} \right \|^2 \leq (\frac{1}{2L} - \frac{1}{L_{\theta}}) \left \| \hat{I}_h(\theta (u^{n,j-1}-\theta (u^n))) \right \|^2 +\frac{L}{2}\left \| \hat{I} e^{n,j-1}\right \|^2
			\end{gathered}
		\end{equation}
		Since $L_{\theta} \leq L$ we can remove the first term on the right side from the inequality. We can also use the lemma \ref{lemma:int_error} about the interpolation error:
		\begin{equation}
			\left \| \hat{I}_h e^{n,j} \right \|^2 = \left \| \hat{I}_h e^{n,j} - e^{n,j} + e^{n,j} \right \|^2 \leq (ch\left \| e^{n,j}\right \| + \left \| e^{n,j} \right \|)^2=(1+ch)^2\left \| e^{n,j} \right \|^2
		\end{equation}
		Now \eqref{eq:L-proof} becomes:
		\begin{equation}
			(\frac{L}{2}+\frac{\tau \kappa_m }{C_{\Omega}(1 + ch)^2})\left \| \hat{I}_h e^{n,j} \right \|^2 \leq \frac{L}{2} \left \| \hat{I}_h e^{n,j-1}\right \|^2
		\end{equation}
	\end{proof}
	
\end{document}